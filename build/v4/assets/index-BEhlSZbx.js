(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();let d=null;window.startTimer=function(){d&&d.startTimer()};window.pauseTimer=function(){d&&d.pauseTimer()};window.stopTimer=function(){d&&d.stopTimer()};window.setDailyGoal=function(){d&&d.setDailyGoal()};window.hideToast=function(){const c=document.getElementById("notification-toast");c&&c.classList.add("hidden")};window.logout=function(){confirm("Are you sure you want to logout?")&&(localStorage.clear(),window.location.href="auth.html")};class p{constructor(){this.timer={startTime:null,pausedTime:0,isRunning:!1,isPaused:!1,interval:null},this.quotes=[{text:"Success is the sum of small efforts repeated day in and day out.",author:"Robert Collier"},{text:"The expert in anything was once a beginner.",author:"Helen Hayes"},{text:"Don't watch the clock; do what it does. Keep going.",author:"Sam Levenson"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{text:"The only way to do great work is to love what you do.",author:"Steve Jobs"},{text:"Believe you can and you're halfway there.",author:"Theodore Roosevelt"},{text:"It does not matter how slowly you go as long as you do not stop.",author:"Confucius"},{text:"Everything you've ever wanted is on the other side of fear.",author:"George Addair"},{text:"Hardships often prepare ordinary people for an extraordinary destiny.",author:"C.S. Lewis"},{text:"The future belongs to those who believe in the beauty of their dreams.",author:"Eleanor Roosevelt"}],this.reminders={break:{enabled:!0,interval:25*60*1e3,lastReminder:0},water:{enabled:!0,interval:60*60*1e3,lastReminder:0},goal:{enabled:!0}},this.init()}init(){this.loadData(),this.setupEventListeners(),this.updateDisplay(),this.rotateQuote(),this.requestNotificationPermission(),setInterval(()=>this.rotateQuote(),3e4),setInterval(()=>this.checkReminders(),6e4),setInterval(()=>{this.timer.isRunning&&this.updateDisplay()},1e3)}setupEventListeners(){const t=document.getElementById("daily-target");t&&t.addEventListener("change",()=>this.setDailyGoal());const e=document.getElementById("break-reminders");e&&e.addEventListener("change",n=>{this.reminders.break.enabled=n.target.checked,this.saveData()});const i=document.getElementById("water-reminders");i&&i.addEventListener("change",n=>{this.reminders.water.enabled=n.target.checked,this.saveData()});const s=document.getElementById("goal-reminders");s&&s.addEventListener("change",n=>{this.reminders.goal.enabled=n.target.checked,this.saveData()})}startTimer(){this.timer.isPaused?(this.timer.startTime=Date.now()-this.timer.pausedTime,this.timer.isPaused=!1):(this.timer.startTime=Date.now(),this.timer.pausedTime=0),this.timer.isRunning=!0;const t=document.getElementById("start-btn"),e=document.getElementById("pause-btn"),i=document.getElementById("stop-btn");t&&(t.disabled=!0),e&&(e.disabled=!1),i&&(i.disabled=!1),this.showNotification("Study session started! 📚","success"),this.saveData()}pauseTimer(){if(this.timer.isRunning){this.timer.pausedTime=Date.now()-this.timer.startTime,this.timer.isRunning=!1,this.timer.isPaused=!0;const t=document.getElementById("start-btn"),e=document.getElementById("pause-btn");t&&(t.disabled=!1),e&&(e.disabled=!0),this.showNotification("Study session paused ⏸️","warning"),this.saveData()}}stopTimer(){if(this.timer.isRunning||this.timer.isPaused){const t=this.timer.isPaused?this.timer.pausedTime:Date.now()-this.timer.startTime,e=Math.floor(t/6e4);e>0&&(this.recordSession(e),this.showNotification(`Great job! You studied for ${e} minutes! 🎉`,"success")),this.resetTimer()}}resetTimer(){this.timer={startTime:null,pausedTime:0,isRunning:!1,isPaused:!1,interval:null};const t=document.getElementById("start-btn"),e=document.getElementById("pause-btn"),i=document.getElementById("stop-btn");t&&(t.disabled=!1),e&&(e.disabled=!0),i&&(i.disabled=!0);const s=document.getElementById("timer-hours"),n=document.getElementById("timer-minutes"),o=document.getElementById("timer-seconds");s&&(s.textContent="00"),n&&(n.textContent="00"),o&&(o.textContent="00"),this.saveData()}updateDisplay(){if(this.timer.isRunning){const t=Date.now()-this.timer.startTime;this.displayTime(t)}else this.timer.isPaused&&this.displayTime(this.timer.pausedTime);this.updateStats(),this.updateProgress()}displayTime(t){const e=Math.floor(t/1e3),i=Math.floor(e/3600),s=Math.floor(e%3600/60),n=e%60,o=document.getElementById("timer-hours"),r=document.getElementById("timer-minutes"),a=document.getElementById("timer-seconds");o&&(o.textContent=i.toString().padStart(2,"0")),r&&(r.textContent=s.toString().padStart(2,"0")),a&&(a.textContent=n.toString().padStart(2,"0"))}recordSession(t){const e=new Date().toDateString(),i=document.getElementById("session-category"),s=i&&this.sanitizeInput(i.value)||"General Study",n=this.getData("sessions")||[],o=this.getData("dailyStats")||{};n.push({date:e,minutes:Math.max(0,Math.min(480,t)),category:s,timestamp:Date.now()}),o[e]||(o[e]={minutes:0,sessions:0}),o[e].minutes+=t,o[e].sessions+=1,this.setData("sessions",n),this.setData("dailyStats",o),i&&(i.value=""),this.updateStats(),this.updateProgress()}setDailyGoal(){const t=document.getElementById("daily-target");if(!t)return;let e=parseInt(t.value)||120;e=Math.max(15,Math.min(480,e));const i=new Date().toDateString(),s=this.getData("goals")||{};s[i]=e,this.setData("goals",s),this.updateProgress(),this.showNotification(`Daily goal set to ${e} minutes!`,"success")}updateStats(){var f;const t=new Date().toDateString(),e=this.getData("dailyStats")||{},i=this.getData("sessions")||[],s=((f=e[t])==null?void 0:f.minutes)||0,n=document.getElementById("today-minutes");n&&(n.textContent=s);const o=new Date;o.setDate(o.getDate()-o.getDay());const r=Object.entries(e).filter(([h])=>new Date(h)>=o).reduce((h,[,y])=>h+y.minutes,0),a=document.getElementById("week-minutes");a&&(a.textContent=r);const u=this.calculateStreak(),l=document.getElementById("current-streak");l&&(l.textContent=u);const m=i.length,g=document.getElementById("total-sessions");g&&(g.textContent=m)}updateProgress(){var m;const t=new Date().toDateString(),e=this.getData("dailyStats")||{},i=this.getData("goals")||{},s=((m=e[t])==null?void 0:m.minutes)||0,n=i[t]||120,o=Math.min(100,s/n*100),r=document.getElementById("progress-fill");r&&(r.style.width=`${o}%`);const a=document.getElementById("minutes-studied"),u=document.getElementById("target-minutes"),l=document.getElementById("progress-percentage");a&&(a.textContent=s),u&&(u.textContent=n),l&&(l.textContent=Math.round(o))}calculateStreak(){var n;const t=this.getData("dailyStats")||{},e=this.getData("goals")||{};let i=0;const s=new Date;for(let o=0;o<365;o++){const r=new Date(s);r.setDate(s.getDate()-o);const a=r.toDateString(),u=((n=t[a])==null?void 0:n.minutes)||0,l=e[a]||120;if(u>=l*.8)i++;else break}return i}rotateQuote(){const t=this.quotes[Math.floor(Math.random()*this.quotes.length)],e=document.getElementById("daily-quote"),i=document.querySelector(".quote-author");e&&i&&(e.textContent=`"${t.text}"`,i.textContent=`- ${t.author}`)}checkReminders(){var e;const t=Date.now();if(this.reminders.break.enabled&&this.timer.isRunning&&t-this.timer.startTime>=this.reminders.break.interval&&t-this.reminders.break.lastReminder>=this.reminders.break.interval&&(this.showNotification("Time for a break! 🧘‍♂️","info"),this.reminders.break.lastReminder=t),this.reminders.water.enabled&&t-this.reminders.water.lastReminder>=this.reminders.water.interval&&(this.showNotification("Don't forget to drink water! 💧","info"),this.reminders.water.lastReminder=t),this.reminders.goal.enabled&&new Date().getHours()===18){const s=new Date().toDateString(),n=this.getData("dailyStats")||{},o=this.getData("goals")||{},r=((e=n[s])==null?void 0:e.minutes)||0,a=o[s]||120;r<a*.5&&this.showNotification("You're behind on your daily goal! 📚","warning")}}requestNotificationPermission(){"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()}showNotification(t,e="info"){"Notification"in window&&Notification.permission==="granted"&&new Notification("SomaBora",{body:t,icon:"https://public-frontend-cos.metadl.com/mgx/img/favicon.png"});const i=document.getElementById("notification-toast"),s=document.getElementById("toast-message");i&&s&&(s.textContent=t,i.className=`toast ${e}`,i.classList.remove("hidden"),setTimeout(()=>{i.classList.add("hidden")},5e3))}sanitizeInput(t){return typeof t!="string"?"":t.replace(/[<>"'&]/g,"").trim().substring(0,100)}getData(t){try{const e=localStorage.getItem(`somabora_${t}`);return e?JSON.parse(e):null}catch(e){return console.error("Error reading data:",e),null}}setData(t,e){try{localStorage.setItem(`somabora_${t}`,JSON.stringify(e))}catch(i){console.error("Error saving data:",i),this.showNotification("Error saving data. Storage might be full.","error")}}saveData(){this.setData("timer",this.timer),this.setData("reminders",this.reminders)}loadData(){const t=this.getData("timer"),e=this.getData("reminders");if(t&&!t.isRunning&&(this.timer={...this.timer,...t}),e){this.reminders={...this.reminders,...e};const i=document.getElementById("break-reminders"),s=document.getElementById("water-reminders"),n=document.getElementById("goal-reminders");i&&(i.checked=this.reminders.break.enabled),s&&(s.checked=this.reminders.water.enabled),n&&(n.checked=this.reminders.goal.enabled)}}}document.addEventListener("DOMContentLoaded",function(){localStorage.getItem("somabora_user"),d=new p,console.log("SomaBora initialized successfully!")});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(c=>console.log("SW registered")).catch(c=>console.log("SW registration failed"))});
